esphome:
  name: printfarmbutton
  friendly_name: PrintFarmButton
  name_add_mac_suffix: true
  project:
    name: spuder.PrintFarmButton
    version: ${version}

  platformio_options:
    build_flags:
    - -DARDUINOJSON_DOCUMENT_SIZE=32768
    - -DMQTT_MAX_PACKET_SIZE=32768
    - -DARDUINOJSON_DEFAULT_NESTING_LIMIT=20
    - -DARDUINOJSON_STRING_BUFFER_SIZE=6144
    sdkconfig_options:
    - CONFIG_MQTT_OUTGOING_BUFFER_SIZE=32768
    - CONFIG_MQTT_INCOMING_BUFFER_SIZE=32768 # Increase LwIP memory for more TCP buffers
    - CONFIG_LWIP_TCP_SND_BUF_DEFAULT=16384
    - CONFIG_LWIP_TCP_WND_DEFAULT=16384
    - CONFIG_LWIP_TCP_RECVMBOX_SIZE=32
    - CONFIG_LWIP_TCP_ACCEPTMBOX_SIZE=32
    # TODO: look for max_packet_size or message_size_limit or buffer_size

    # lib_deps:
    # - bblanchon/ArduinoJson@6.19.4
    # lib_ignore:
    # - ArduinoJson
    # - Json
  on_boot:
    then:
    - light.turn_on:
        id: printfarmbutton_rgb
        effect: Rainbow
    - delay: 3s

packages:
  led: !include conf.d/led.yaml
  web_server: !include conf.d/web_server.yaml
  cloud: !include conf.d/cloud.yaml
  cloud_printago: !include conf.d/cloud_printago.yaml
  cloud_bambu: !include conf.d/cloud_bambu.yaml
  mqtt: !include conf.d/mqtt.yaml
  mqtt_bambu: !include conf.d/mqtt_bambu.yaml
  mqtt_printago: !include conf.d/mqtt_printago.yaml
  button: !include conf.d/button.yaml
  wifi: !include conf.d/wifi.yaml
  update: !include conf.d/update.yaml
  version: !include conf.d/version.yaml
  scripts: !include conf.d/scripts.yaml
  debug: !include conf.d/debug.yaml
logger:
  level: VERBOSE
  logs:
    mqtt.component: VERBOSE
    mqtt.client: VERBOSE
    mqtt: VERBOSE

ota:
- platform: esphome
- platform: http_request

http_request:
  verify_ssl: false

improv_serial:
  next_url: http://{{device_name}}.local

api:
  reboot_timeout: 0s
